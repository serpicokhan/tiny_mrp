<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill of Materials Management</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .bom-header {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .component-list {
            border: 1px solid #dee2e6;
            border-radius: 5px;
        }
        .component-item {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
            transition: background-color 0.2s;
        }
        .component-item:last-child {
            border-bottom: none;
        }
        .component-item:hover {
            background-color: #f8f9fa;
        }
        .operation-time {
            font-weight: bold;
            color: #0d6efd;
        }
        .action-buttons .btn {
            margin-right: 5px;
        }
        .search-box {
            margin-bottom: 20px;
        }
        .view-toggle {
            cursor: pointer;
        }
        .view-toggle.active {
            color: #0d6efd;
        }
        .bom-card {
            height: 100%;
            transition: transform 0.2s;
        }
        .bom-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .bom-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        .pagination-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        .table-responsive {
            max-height: 600px;
            overflow-y: auto;
        }
        .table thead th {
            position: sticky;
            top: 0;
            background-color: #f8f9fa;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row mb-4">
            <div class="col">
                <h2><i class="fas fa-list-alt me-2"></i>Bill of Materials</h2>
            </div>
            <div class="col text-end">
                <button class="btn btn-primary" id="create-bom-btn">
                    <i class="fas fa-plus me-1"></i> Create BOM
                </button>
            </div>
        </div>

        <!-- Search and Filter -->
        <div class="row search-box">
            <div class="col-md-4">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search BOMs..." id="bom-search">
                    <button class="btn btn-outline-secondary" type="button">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            <div class="col-md-4">
                <select class="form-select" id="product-filter">
                    <option value="">Filter by Product</option>
                    <!-- Options will be populated via AJAX -->
                </select>
            </div>
            <div class="col-md-4 text-end">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-secondary view-toggle active" id="table-view-btn" data-view="table">
                        <i class="fas fa-table"></i> Table
                    </button>
                    <button type="button" class="btn btn-outline-secondary view-toggle" id="grid-view-btn" data-view="grid">
                        <i class="fas fa-th-large"></i> Grid
                    </button>
                </div>
            </div>
        </div>

        <!-- BOM List Container -->
        <div class="row">
            <div class="col-12">
                <!-- Table View -->
                <div id="table-view" class="view-content">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">BOM List</h5>
                            <small class="text-muted" id="table-count-info">Showing 1-5 of 10 BOMs</small>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>Reference</th>
                                        <th>Product</th>
                                        <th>Components</th>
                                        <th>Operation Time</th>
                                        <th>Last Updated</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="bom-table-body">
                                    <!-- BOM rows will be loaded here -->
                                    <tr>
                                        <td colspan="6" class="text-center py-5 text-muted" id="empty-bom-table">
                                            No BOMs found. Click "Create BOM" to add one.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="card-footer">
                            <div class="pagination-container">
                                <nav>
                                    <ul class="pagination" id="table-pagination">
                                        <li class="page-item disabled">
                                            <a class="page-link" href="#" tabindex="-1">Previous</a>
                                        </li>
                                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                                        <li class="page-item">
                                            <a class="page-link" href="#">Next</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Grid View -->
                <div id="grid-view" class="view-content" style="display: none;">
                    <div class="bom-grid" id="bom-grid">
                        <!-- BOM cards will be loaded here -->
                        <div class="text-center py-5 text-muted w-100" id="empty-bom-grid">
                            No BOMs found. Click "Create BOM" to add one.
                        </div>
                    </div>
                    <div class="pagination-container mt-4">
                        <nav>
                            <ul class="pagination" id="grid-pagination">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1">Previous</a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">Next</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>

        <!-- BOM Detail Modal -->
        <div class="modal fade" id="bom-detail-modal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">BOM Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="bom-detail-content">
                        <div class="bom-header mb-4">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Reference:</strong> <span id="bom-reference"></span></p>
                                    <p><strong>Product:</strong> <span id="bom-product"></span></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Operation Time:</strong> <span class="operation-time" id="bom-operation-time"></span> minutes</p>
                                    <p><strong>Last Updated:</strong> <span id="bom-updated-at"></span></p>
                                </div>
                            </div>
                        </div>

                        <h5 class="mb-3">Components</h5>
                        <div class="component-list mb-4" id="component-list">
                            <!-- Components will be loaded here -->
                            <div class="text-center py-3 text-muted" id="empty-components">
                                No components added to this BOM
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead>
                                    <tr>
                                        <th>Component</th>
                                        <th>Quantity</th>
                                        <th>UoM</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="component-table-body">
                                    <!-- Components will be loaded here -->
                                    <tr id="empty-components">
                                        <td colspan="4" class="text-center py-3 text-muted">
                                            No components added to this BOM
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-success" id="print-bom-btn">
                            <i class="fas fa-print me-1"></i> Print BOM
                        </button>
                        <button class="btn btn-primary" id="edit-bom-btn">
                            <i class="fas fa-edit me-1"></i> Edit
                        </button>
                        <button class="btn btn-outline-danger" id="delete-bom-btn">
                            <i class="fas fa-trash me-1"></i> Delete
                        </button>
                        <button class="btn btn-outline-primary" id="add-component-btn">
                            <i class="fas fa-plus me-1"></i> Add Component
                        </button>
                        
                    </div>
                </div>
            </div>
        </div>

        <!-- Modals -->
        <!-- Create/Edit BOM Modal -->
        <div class="modal fade" id="bom-form-modal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="bom-modal-title">Create New BOM</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="bom-form">
                            <input type="hidden" id="bom-id">
                            <div class="mb-3">
                                <label for="reference" class="form-label">Reference</label>
                                <input type="text" class="form-control" id="reference" required>
                            </div>
                            <div class="mb-3">
                                <label for="product" class="form-label">Product</label>
                                <select class="form-select" id="product" required>
                                    <option value="">Select a product</option>
                                    <!-- Products will be populated via AJAX -->
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="operation-time" class="form-label">Operation Time (minutes)</label>
                                <input type="number" step="0.01" min="0" class="form-control" id="operation-time" required>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="save-bom-btn">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Component Modal -->
        <div class="modal fade" id="component-form-modal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Add Component</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="component-form">
                            <input type="hidden" id="component-bom-id">
                            <div class="mb-3">
                                <label for="component-product" class="form-label">Component</label>
                                <select class="form-select" id="component-product" required>
                                    <option value="">Select a component</option>
                                    <!-- Components will be populated via AJAX -->
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="quantity" class="form-label">Quantity</label>
                                <input type="number" step="0.01" min="0.01" class="form-control" id="quantity" required>
                            </div>
                            <div class="mb-3">
                                <label for="uom" class="form-label">Unit of Measure</label>
                                <select class="form-select" id="uom" required>
                                    <option value="units">Units</option>
                                    <option value="kg">Kilograms</option>
                                    <option value="g">Grams</option>
                                    <option value="l">Liters</option>
                                    <option value="ml">Milliliters</option>
                                    <option value="m">Meters</option>
                                    <option value="cm">Centimeters</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="save-component-btn">Add Component</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="delete-confirm-modal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Confirm Deletion</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete this BOM? This action cannot be undone.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" id="confirm-delete-btn">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Global variables
            let currentBomId = null;
            let currentPage = 1;
            const itemsPerPage = 5;
            let currentView = 'table'; // 'table' or 'grid'
            
            // Initialize the page
            loadBomList();
            loadProductFilter();
            
            // Event handlers
            $('#create-bom-btn').click(showCreateBomModal);
            $('#edit-bom-btn').click(showEditBomModal);
            $('#delete-bom-btn').click(showDeleteConfirmModal);
            $('#save-bom-btn').click(saveBom);
            $('#save-component-btn').click(saveComponent);
            $('#confirm-delete-btn').click(deleteBom);
            $('#print-bom-btn').click(printBom);
            $('#bom-search').on('keyup', filterBoms);
            $('#product-filter').change(filterBoms);
            
            // View toggle buttons
            $('.view-toggle').click(function() {
                const view = $(this).data('view');
                setView(view);
            });
            
            // Pagination handlers
            $(document).on('click', '.page-link', function(e) {
                e.preventDefault();
                const page = $(this).text().toLowerCase();
                
                if (page === 'previous') {
                    if (currentPage > 1) {
                        currentPage--;
                        loadBomList();
                    }
                } else if (page === 'next') {
                    currentPage++;
                    loadBomList();
                } else if (!isNaN(page)) {
                    currentPage = parseInt(page);
                    loadBomList();
                }
            });
            
            // Set the current view (table or grid)
            function setView(view) {
                currentView = view;
                $('.view-toggle').removeClass('active');
                $(`#${view}-view-btn`).addClass('active');
                
                $('.view-content').hide();
                $(`#${view}-view`).show();
                
                // Reload the data in the current view
                loadBomList();
            }
            
            // Load BOM list from server
            function loadBomList() {
                // In a real app, this would be an AJAX call to your Django backend
                // For demo purposes, we'll use mock data
                const mockBoms = [
                    {
                        id: 1,
                        reference: "BOM-001",
                        product: { id: 101, name: "Finished Product A" },
                        operation_time: 45.5,
                        updated_at: "2023-06-15T14:30:00Z",
                        components: [
                            { id: 201, product: { id: 201, name: "Component X" }, quantity: 2, uom: "units" },
                            { id: 202, product: { id: 202, name: "Component Y" }, quantity: 1.5, uom: "kg" }
                        ]
                    },
                    {
                        id: 2,
                        reference: "BOM-002",
                        product: { id: 102, name: "Finished Product B" },
                        operation_time: 30.0,
                        updated_at: "2023-06-10T09:15:00Z",
                        components: [
                            { id: 203, product: { id: 203, name: "Component Z" }, quantity: 3, uom: "units" }
                        ]
                    },
                    {
                        id: 3,
                        reference: "BOM-003",
                        product: { id: 103, name: "Finished Product C" },
                        operation_time: 60.0,
                        updated_at: "2023-06-18T10:20:00Z",
                        components: [
                            { id: 204, product: { id: 204, name: "Component A" }, quantity: 4, uom: "units" },
                            { id: 205, product: { id: 205, name: "Component B" }, quantity: 2.5, uom: "kg" },
                            { id: 206, product: { id: 206, name: "Component C" }, quantity: 1, uom: "l" }
                        ]
                    },
                    {
                        id: 4,
                        reference: "BOM-004",
                        product: { id: 104, name: "Finished Product D" },
                        operation_time: 25.0,
                        updated_at: "2023-06-20T08:45:00Z",
                        components: [
                            { id: 207, product: { id: 207, name: "Component D" }, quantity: 2, uom: "units" }
                        ]
                    },
                    {
                        id: 5,
                        reference: "BOM-005",
                        product: { id: 105, name: "Finished Product E" },
                        operation_time: 35.5,
                        updated_at: "2023-06-22T16:10:00Z",
                        components: []
                    },
                    {
                        id: 6,
                        reference: "BOM-006",
                        product: { id: 106, name: "Finished Product F" },
                        operation_time: 42.0,
                        updated_at: "2023-06-25T11:30:00Z",
                        components: [
                            { id: 208, product: { id: 208, name: "Component E" }, quantity: 3, uom: "units" },
                            { id: 209, product: { id: 209, name: "Component F" }, quantity: 1.2, uom: "kg" }
                        ]
                    }
                ];
                
                // Apply filtering if any
                const filteredBoms = filterBomData(mockBoms);
                const totalItems = filteredBoms.length;
                const totalPages = Math.ceil(totalItems / itemsPerPage);
                
                // Paginate the data
                const startIndex = (currentPage - 1) * itemsPerPage;
                const paginatedBoms = filteredBoms.slice(startIndex, startIndex + itemsPerPage);
                
                // Update count info
                const startItem = startIndex + 1;
                const endItem = Math.min(startIndex + itemsPerPage, totalItems);
                $('#table-count-info').text(`Showing ${startItem}-${endItem} of ${totalItems} BOMs`);
                
                // Update pagination controls
                updatePagination(totalPages);
                
                if (paginatedBoms.length > 0) {
                    if (currentView === 'table') {
                        renderBomTable(paginatedBoms);
                    } else {
                        renderBomGrid(paginatedBoms);
                    }
                } else {
                    if (currentView === 'table') {
                        $('#empty-bom-table').show();
                        $('#bom-table-body').empty();
                    } else {
                        $('#empty-bom-grid').show();
                        $('#bom-grid').empty();
                    }
                }
            }
            
            // Filter BOM data based on search and product filter
            function filterBomData(boms) {
                const searchTerm = $('#bom-search').val().toLowerCase();
                const productId = $('#product-filter').val();
                
                return boms.filter(bom => {
                    const matchesSearch = searchTerm === '' || 
                        bom.reference.toLowerCase().includes(searchTerm) || 
                        bom.product.name.toLowerCase().includes(searchTerm);
                    
                    const matchesProduct = productId === '' || bom.product.id == productId;
                    
                    return matchesSearch && matchesProduct;
                });
            }
            
            // Update pagination controls
            function updatePagination(totalPages) {
                const paginationHtml = generatePaginationHtml(totalPages);
                $('#table-pagination').html(paginationHtml);
                $('#grid-pagination').html(paginationHtml);
            }
            
            // Generate pagination HTML
            function generatePaginationHtml(totalPages) {
                let html = `
                    <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" tabindex="-1">Previous</a>
                    </li>
                `;
                
                for (let i = 1; i <= totalPages; i++) {
                    html += `
                        <li class="page-item ${currentPage === i ? 'active' : ''}">
                            <a class="page-link" href="#">${i}</a>
                        </li>
                    `;
                }
                
                html += `
                    <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                        <a class="page-link" href="#">Next</a>
                    </li>
                `;
                
                return html;
            }
            
            // Render BOM table view
            function renderBomTable(boms) {
                $('#empty-bom-table').hide();
                $('#bom-table-body').empty();
                
                boms.forEach(bom => {
                    const bomRow = $(`
                        <tr data-bom-id="${bom.id}">
                            <td><strong>${bom.reference}</strong></td>
                            <td>${bom.product.name}</td>
                            <td>${bom.components.length} components</td>
                            <td>${bom.operation_time} min</td>
                            <td>${formatDate(bom.updated_at)}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary view-bom-btn" data-bom-id="${bom.id}">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="btn btn-sm btn-outline-secondary edit-bom-btn" data-bom-id="${bom.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                    
                    bomRow.find('.view-bom-btn').click(function() {
                        loadBomDetails(bom.id);
                        $('#bom-detail-modal').modal('show');
                    });
                    
                    bomRow.find('.edit-bom-btn').click(function() {
                        showEditBomModal(bom.id);
                    });
                    
                    $('#bom-table-body').append(bomRow);
                });
            }
            
            // Render BOM grid view
            function renderBomGrid(boms) {
                $('#empty-bom-grid').hide();
                $('#bom-grid').empty();
                
                boms.forEach(bom => {
                    const bomCard = $(`
                        <div class="card bom-card" data-bom-id="${bom.id}">
                            <div class="card-header">
                                <h5 class="card-title mb-0">${bom.reference}</h5>
                            </div>
                            <div class="card-body">
                                <p class="card-text"><strong>Product:</strong> ${bom.product.name}</p>
                                <p class="card-text"><strong>Components:</strong> ${bom.components.length}</p>
                                <p class="card-text"><strong>Operation Time:</strong> ${bom.operation_time} min</p>
                                <p class="card-text"><small class="text-muted">Last updated: ${formatDate(bom.updated_at)}</small></p>
                            </div>
                            <div class="card-footer bg-transparent">
                                <button class="btn btn-sm btn-outline-primary view-bom-btn" data-bom-id="${bom.id}">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="btn btn-sm btn-outline-secondary edit-bom-btn" data-bom-id="${bom.id}">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </div>
                        </div>
                    `);
                    
                    bomCard.find('.view-bom-btn').click(function() {
                        loadBomDetails(bom.id);
                        $('#bom-detail-modal').modal('show');
                    });
                    
                    bomCard.find('.edit-bom-btn').click(function() {
                        showEditBomModal(bom.id);
                    });
                    
                    $('#bom-grid').append(bomCard);
                });
            }
            
            // Load product filter options
            function loadProductFilter() {
                // In a real app, this would be an AJAX call to get finished products
                const mockProducts = [
                    { id: 101, name: "Finished Product A" },
                    { id: 102, name: "Finished Product B" },
                    { id: 103, name: "Finished Product C" },
                    { id: 104, name: "Finished Product D" },
                    { id: 105, name: "Finished Product E" },
                    { id: 106, name: "Finished Product F" }
                ];
                
                mockProducts.forEach(product => {
                    $('#product-filter').append(`<option value="${product.id}">${product.name}</option>`);
                });
            }
            
            // Load BOM details
            function loadBomDetails(bomId) {
                currentBomId = bomId;
                
                // In a real app, this would be an AJAX call
                const mockBoms = [
                    {
                        id: 1,
                        reference: "BOM-001",
                        product: { id: 101, name: "Finished Product A" },
                        operation_time: 45.5,
                        updated_at: "2023-06-15T14:30:00Z",
                        components: [
                            { id: 201, product: { id: 201, name: "Component X" }, quantity: 2, uom: "units" },
                            { id: 202, product: { id: 202, name: "Component Y" }, quantity: 1.5, uom: "kg" }
                        ]
                    },
                    {
                        id: 2,
                        reference: "BOM-002",
                        product: { id: 102, name: "Finished Product B" },
                        operation_time: 30.0,
                        updated_at: "2023-06-10T09:15:00Z",
                        components: [
                            { id: 203, product: { id: 203, name: "Component Z" }, quantity: 3, uom: "units" }
                        ]
                    },
                    {
                        id: 3,
                        reference: "BOM-003",
                        product: { id: 103, name: "Finished Product C" },
                        operation_time: 60.0,
                        updated_at: "2023-06-18T10:20:00Z",
                        components: [
                            { id: 204, product: { id: 204, name: "Component A" }, quantity: 4, uom: "units" },
                            { id: 205, product: { id: 205, name: "Component B" }, quantity: 2.5, uom: "kg" },
                            { id: 206, product: { id: 206, name: "Component C" }, quantity: 1, uom: "l" }
                        ]
                    },
                    {
                        id: 4,
                        reference: "BOM-004",
                        product: { id: 104, name: "Finished Product D" },
                        operation_time: 25.0,
                        updated_at: "2023-06-20T08:45:00Z",
                        components: [
                            { id: 207, product: { id: 207, name: "Component D" }, quantity: 2, uom: "units" }
                        ]
                    },
                    {
                        id: 5,
                        reference: "BOM-005",
                        product: { id: 105, name: "Finished Product E" },
                        operation_time: 35.5,
                        updated_at: "2023-06-22T16:10:00Z",
                        components: []
                    },
                    {
                        id: 6,
                        reference: "BOM-006",
                        product: { id: 106, name: "Finished Product F" },
                        operation_time: 42.0,
                        updated_at: "2023-06-25T11:30:00Z",
                        components: [
                            { id: 208, product: { id: 208, name: "Component E" }, quantity: 3, uom: "units" },
                            { id: 209, product: { id: 209, name: "Component F" }, quantity: 1.2, uom: "kg" }
                        ]
                    }
                ];
                
                const bom = mockBoms.find(b => b.id == bomId);
                if (bom) {
                    // Update header info
                    $('#bom-reference').text(bom.reference);
                    $('#bom-product').text(bom.product.name);
                    $('#bom-operation-time').text(bom.operation_time);
                    $('#bom-updated-at').text(formatDate(bom.updated_at));
                    
                    // Update components list
                    if (bom.components.length > 0) {
                        $('#empty-components').hide();
                        $('#component-list').empty();
                        
                        bom.components.forEach(component => {
                            const componentItem = $(`
                                <div class="component-item" data-component-id="${component.id}">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong>${component.product.name}</strong>
                                            <div class="text-muted">Quantity: ${component.quantity} ${component.uom}</div>
                                        </div>
                                        <button class="btn btn-sm btn-outline-danger remove-component-btn">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            `);
                            
                            componentItem.find('.remove-component-btn').click(function() {
                                removeComponent(component.id);
                            });
                            
                            $('#component-list').append(componentItem);
                        });
                    } else {
                        $('#empty-components').show();
                    }
                }
            }
            
            // Show create BOM modal
            function showCreateBomModal() {
                $('#bom-modal-title').text('Create New BOM');
                $('#bom-id').val('');
                $('#bom-form')[0].reset();
                $('#bom-form-modal').modal('show');
            }
            
            // Show edit BOM modal
            function showEditBomModal(bomId = null) {
                const editBomId = bomId || currentBomId;
                if (!editBomId) return;
                
                // In a real app, you would fetch the BOM data via AJAX
                const mockBoms = [
                    {
                        id: 1,
                        reference: "BOM-001",
                        product: { id: 101, name: "Finished Product A" },
                        operation_time: 45.5
                    },
                    {
                        id: 2,
                        reference: "BOM-002",
                        product: { id: 102, name: "Finished Product B" },
                        operation_time: 30.0
                    },
                    {
                        id: 3,
                        reference: "BOM-003",
                        product: { id: 103, name: "Finished Product C" },
                        operation_time: 60.0
                    },
                    {
                        id: 4,
                        reference: "BOM-004",
                        product: { id: 104, name: "Finished Product D" },
                        operation_time: 25.0
                    },
                    {
                        id: 5,
                        reference: "BOM-005",
                        product: { id: 105, name: "Finished Product E" },
                        operation_time: 35.5
                    },
                    {
                        id: 6,
                        reference: "BOM-006",
                        product: { id: 106, name: "Finished Product F" },
                        operation_time: 42.0
                    }
                ];
                
                const bom = mockBoms.find(b => b.id == editBomId);
                if (bom) {
                    $('#bom-modal-title').text('Edit BOM');
                    $('#bom-id').val(bom.id);
                    $('#reference').val(bom.reference);
                    $('#product').val(bom.product.id);
                    $('#operation-time').val(bom.operation_time);
                    $('#bom-form-modal').modal('show');
                }
            }
            
            // Save BOM (create or update)
            function saveBom() {
                const form = $('#bom-form')[0];
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const bomData = {
                    id: $('#bom-id').val(),
                    reference: $('#reference').val(),
                    product_id: $('#product').val(),
                    operation_time: $('#operation-time').val()
                };
                
                // In a real app, this would be an AJAX call to your Django backend
                console.log('Saving BOM:', bomData);
                
                // Simulate success
                $('#bom-form-modal').modal('hide');
                loadBomList(); // Refresh the list
                
                if (bomData.id) {
                    showToast('BOM updated successfully!', 'success');
                } else {
                    showToast('BOM created successfully!', 'success');
                }
            }
            
            // Show add component modal
            function showAddComponentModal() {
                if (!currentBomId) return;
                
                $('#component-bom-id').val(currentBomId);
                $('#component-form')[0].reset();
                $('#component-form-modal').modal('show');
            }
            
            // Save component
            function saveComponent() {
                const form = $('#component-form')[0];
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const componentData = {
                    bom_id: $('#component-bom-id').val(),
                    product_id: $('#component-product').val(),
                    quantity: $('#quantity').val(),
                    uom: $('#uom').val()
                };
                
                // In a real app, this would be an AJAX call to your Django backend
                console.log('Adding component:', componentData);
                
                // Simulate success
                $('#component-form-modal').modal('hide');
                loadBomDetails(currentBomId); // Refresh the BOM details
                showToast('Component added successfully!', 'success');
            }
            
            // Remove component
            function removeComponent(componentId) {
                if (!confirm('Are you sure you want to remove this component?')) return;
                
                // In a real app, this would be an AJAX call to your Django backend
                console.log('Removing component:', componentId);
                
                // Simulate success
                loadBomDetails(currentBomId); // Refresh the BOM details
                showToast('Component removed successfully!', 'success');
            }
            
            // Show delete confirmation modal
            function showDeleteConfirmModal() {
                if (!currentBomId) return;
                $('#delete-confirm-modal').modal('show');
            }
            
            // Delete BOM
            function deleteBom() {
                $('#delete-confirm-modal').modal('hide');
                
                // In a real app, this would be an AJAX call to your Django backend
                console.log('Deleting BOM:', currentBomId);
                
                // Simulate success
                currentBomId = null;
                loadBomList(); // Refresh the list
                $('#bom-detail-modal').modal('hide');
                showToast('BOM deleted successfully!', 'success');
            }
            
            // Print BOM
            function printBom() {
                if (!currentBomId) return;
                window.print(); // In a real app, you might generate a more print-friendly version
            }
            
            // Filter BOMs
            function filterBoms() {
                currentPage = 1; // Reset to first page when filtering
                loadBomList();
            }
            
            // Helper function to format date
            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
            }
            
            // Helper function to show toast messages
            function showToast(message, type = 'success') {
                // In a real app, you would use a proper toast library
                alert(`${type.toUpperCase()}: ${message}`);
            }
        });
    </script>
</body>
</html>