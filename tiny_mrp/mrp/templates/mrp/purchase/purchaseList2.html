{% extends 'mrp/temp2.html' %}
{% load custom_filters %}
{% load static %}
{% block stylesheet %}
     <!-- Select2 -->
     <link rel="stylesheet" href="{% static 'vendors/select2/css/select2.min.css' %}" type="text/css">
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tributejs@5.1.3/dist/tribute.css">
     <style>
        .modal-backdrop {
            z-index: 1040 !important; /* Lower z-index for backdrop */
        }
        
        .modal {
            z-index: 1050 !important; /* Higher z-index for modal */
        }
          .table-wrapper {
            overflow-x: auto;
        }
        .parts-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        .parts-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .parts-table th {
            font-weight: 600;
            padding: 15px;
            border: none;
        }
        .parts-table td {
            padding: 12px 15px;
            vertical-align: middle;
        }
        .parts-table tbody tr {
            transition: all 0.3s;
        }
        .parts-table tbody tr:hover {
            background-color: #f8f9ff;
            transform: scale(1.01);
        }
        .btn-history {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 25px;
            transition: all 0.3s;
            font-size: 14px;
        }
        .btn-history:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            color: white;
        }
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px 10px 0 0;
        }
        .history-item {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-right: 4px solid #667eea;
            transition: all 0.3s;
        }
        .history-item:hover {
            transform: translateX(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .price-badge {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 10px;
        }
        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-available {
            background-color: #d4edda;
            color: #155724;
        }
        .status-low {
            background-color: #fff3cd;
            color: #856404;
        }
        .status-out {
            background-color: #f8d7da;
            color: #721c24;
        }
        
     </style>
     

{% endblock %}
{% block content %}

<div class="container-fluid h-100">

    <div class="row app-block">
        <div class="col-md-3 app-sidebar main_slidebar">
            <div class="card">
                <div class="card-body">
                    <button class="btn btn-outline-dark btn-block btn-block2" id="createreq" data-url="{% url 'create_purchase' %}" >
                        درخواست جدید                   </button>
                        <button class="btn btn-outline-dark btn-block btn-block3" data-url="#" >
                        خروجی اکسل                 </button>
                       
                </div>
                <div class="app-sidebar-menu">
                    <form class="">

                    <div class="list-group list-group-flush">
                        <a  class="list-group-item active d-flex align-items-center">
                            <i data-feather="filter" class="mr-2 width-15 height-15"></i>
                            فیلتر تاریخ
                            <span class="small ml-auto"></span>
                        </a>
                        
                        <a  class="list-group-item d-flex align-items-center">
                            
                            <input class=" form-control " type="text" name="start" value={{start}}>
                           
                           
                    
                        </a>
                        <a  class="list-group-item d-flex align-items-center">
                            
                            <input class=" form-control " type="text" name="end" value={{end}}>
                           
                           
                    
                        </a>
                        
                        {% if perms.mrp.can_admin_purchase %}
                        <a  class="list-group-item active d-flex align-items-center">
                            <i data-feather="filter" class="mr-2 width-15 height-15"></i>
                            فیلتر اشخاص
                            <span class="small ml-auto"></span>
                        </a>
                        <a  class="list-group-item d-flex align-items-center">
                            
                            <select class="select2-example" name="userlist" multiple>
                               
                            {% for i in users %}
                                <option value="{{i.id}}" {% if i.id in userlist %} selected {% endif %} >{{i}}</option>
                            {% endfor %}
                             
                              </select>
                        </a>
                        {% endif %}
                        <a  class="list-group-item d-flex align-items-center">
                            
                            <div class="custom-control custom-switch custom-checkbox-warning">
                                <input type="checkbox" class="custom-control-input" id="customSwitch3_" name="customSwitch3_" {% if is_tamiri%} checked {% endif %}>
                                <label class="custom-control-label" for="customSwitch3_">
                                    درخواست تعمیر
                                    
                                   </label>
                            </div>
                           
                           
                    
                        </a>
                        <a  class="list-group-item d-flex align-items-center">
                            
                            <button class="btn btn-outline-dark btn-block btn-block4" type="submit" data-url="#" >
                                فیلتر                </button>
                           
                           
                    
                        </a>
                    </form>
                        
                    </div>
                    
                </div> 
            </div>
        </div>
        <div class="col-md-3 app-sidebar  d-none" id="update_tab2">
            <div class="card" id="purchase_tab_card">
               
                
            </div>
        </div>
        
        <div class="col-md-9 app-content">
            <div class="app-content-overlay"></div>
            <div class="app-action">
                <div class="action-left">
                    <div class="custom-control custom-checkbox mr-3">
                        <input type="checkbox" class="custom-control-input" id="customCheckAll">
                        <label class="custom-control-label" for="customCheckAll"></label>
                    </div>
                    <ul class="list-inline">
                        <li class="list-inline-item mb-0">
                            <a href="#" class="btn btn-outline-light dropdown-toggle" data-toggle="dropdown">
                                انتخاب بر اساس
                            </a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="?status=Pending{% if sort_by %}&sort_by={{ sort_by }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}{% if start_j %}&start={{ start_j }}{% endif %}{% if end_j %}&end={{ end_j }}{% endif %}">درخواست شده</a>
                                <a class="dropdown-item" href="?status=Approved{% if sort_by %}&sort_by={{ sort_by }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}{% if start_j %}&start={{ start_j }}{% endif %}{% if end_j %}&end={{ end_j }}{% endif %}">تایید انبار</a>
                                <a class="dropdown-item" href="?status=Approve2{% if sort_by %}&sort_by={{ sort_by }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}{% if start_j %}&start={{ start_j }}{% endif %}{% if end_j %}&end={{ end_j }}{% endif %}">تایید مدیرتولید</a>
                                <a class="dropdown-item" href="?status=Approve4{% if sort_by %}&sort_by={{ sort_by }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}{% if start_j %}&start={{ start_j }}{% endif %}{% if end_j %}&end={{ end_j }}{% endif %}">تایید بازرگانی</a>

                                <a class="dropdown-item" href="?status=Approve3{% if sort_by %}&sort_by={{ sort_by }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}{% if start_j %}&start={{ start_j }}{% endif %}{% if end_j %}&end={{ end_j }}{% endif %}">تایید مهندس ارزنده</a>
                                <a class="dropdown-item" href="?status=Ordered{% if sort_by %}&sort_by={{ sort_by }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}{% if start_j %}&start={{ start_j }}{% endif %}{% if end_j %}&end={{ end_j }}{% endif %}">سفارش داده شده</a>
                                <a class="dropdown-item" href="?status=Purchased{% if sort_by %}&sort_by={{ sort_by }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}{% if start_j %}&start={{ start_j }}{% endif %}{% if end_j %}&end={{ end_j }}{% endif %}">خریداری شده</a>
                                <a class="dropdown-item" href="?status=GuardApproved{% if sort_by %}&sort_by={{ sort_by }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}{% if start_j %}&start={{ start_j }}{% endif %}{% if end_j %}&end={{ end_j }}{% endif %}">دریافت ناقص</a>
                                <a class="dropdown-item" href="?status=Completed{% if sort_by %}&sort_by={{ sort_by }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}{% if start_j %}&start={{ start_j }}{% endif %}{% if end_j %}&end={{ end_j }}{% endif %}">کامل شده</a>
                                <a class="dropdown-item" href="?status=Rejected{% if sort_by %}&sort_by={{ sort_by }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}{% if start_j %}&start={{ start_j }}{% endif %}{% if end_j %}&end={{ end_j }}{% endif %}">رد شده</a>
                                
                                <div class="dropdown-divider"></div>
                                
                                <!-- Show All -->
                                <a class="dropdown-item text-danger" href="?{% if sort_by %}sort_by={{ sort_by }}&{% endif %}{% if search_query %}q={{ search_query }}&{% endif %}status=all">همه</a>
                            </div>
                        </li>
                        <li class="list-inline-item mb-0 ">
                            <a href="#" class="btn btn-outline-light dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
                                چینش
                            </a>
                            <div class="dropdown-menu dropdown-menu-right " x-placement="bottom-end" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(807px, 60px, 0px);">
                                
                                <!-- Sorting by last cconfirm date -->
                                <a class="dropdown-item" href="?sort_by=latest_activity_timestamp{% if status %}&status={{ status }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}">تایید (جدیدترین)</a>

                                <!-- Sorting by Date -->
                                <a class="dropdown-item" href="?sort_by=-created_at{% if status %}&status={{ status }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}">تاریخ (جدیدترین)</a>
                                <a class="dropdown-item" href="?sort_by=created_at{% if status %}&status={{ status }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}">تاریخ (قدیمی‌ترین)</a>
                        
                                <!-- Sorting by ID -->
                                <a class="dropdown-item" href="?sort_by=-id{% if status %}&status={{ status }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}">کد (بزرگ‌ترین)</a>
                                <a class="dropdown-item" href="?sort_by=id{% if status %}&status={{ status }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}">کد (کوچک‌ترین)</a>
                        
                                <!-- Sorting by Status -->
                                <a class="dropdown-item" href="?sort_by=status{% if status %}&status={{ status }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}">وضعیت (صعودی)</a>
                                <a class="dropdown-item" href="?sort_by=-status{% if status %}&status={{ status }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}">وضعیت (نزولی)</a>
                        
                                {% comment %} <div class="dropdown-divider"></div> {% endcomment %}
                        
                                <!-- Sorting by Size (Example Field) -->
                                {% comment %} <a class="dropdown-item" href="?sort_by=size">اندازه (صعودی)</a>
                                <a class="dropdown-item" href="?sort_by=-size">اندازه (نزولی)</a> {% endcomment %}
                            </div>
                        </li>
                        
                    </ul>
                </div>
                <div class="action-right">
                    <form class="d-flex mr-3">
                        <a href="#" class="app-sidebar-menu-button btn btn-outline-light">
                            <i data-feather="menu" class="width-15 height-15"></i>
                        </a>
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="جستجوی درخواست"
                                   aria-describedby="button-addon1"  name="q" 
                                   value="{{ search_query }}">
                            <div class="input-group-append">
                                <button class="btn btn-outline-light" type="submit" id="button-addon1">
                                    <i class="ti-search"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                    <div class="app-pager d-flex align-items-center">
                        <div class="mr-3">{{ req.number }} از {{req.paginator.num_pages}}</div>
                        <nav aria-label="Page navigation example">
                            <ul class="pagination">
                                <li class="page-item">
                                {% if req.has_previous %}
                                {% comment %} {% if start %}&start={{ start }}{% endif %}{% if end %}&end={{ end }}{% endif %} {% endcomment %}
                                    <a class="page-link" href="?page={{ req.previous_page_number }}{% if sort_by %}&sort_by={{ sort_by }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% for user_id in userlist %}&userlist={{ user_id }}{% endfor %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}{% if start %}&start={{ start|to_jalali }}{% endif %}{% if end %}&end={{ end|to_jalali }}{% endif %}" aria-label="Previous">
                                        <i data-feather="chevron-left" class="width-15 height-15"></i>
                                    </a>
                                {% else %}
                                <a class="page-link" href="#" aria-label="Previous">
                                    <i data-feather="chevron-left" class="width-15 height-15"></i>
                                </a>
                                {% endif %}

                                </li>
                                <li class="page-item">
                                    {% if req.has_next %}
                                    <a class="page-link" href="?page={{ req.next_page_number }}{% if sort_by %}&sort_by={{ sort_by }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if search_query %}&q={{ search_query }}{% endif %}{% for user_id in userlist %}&userlist={{ user_id }}{% endfor %}{% if is_tamiri %}&customSwitch3_={{ is_tamiri }}{% endif %}{% if start %}&start={{ start|to_jalali }}{% endif %}{% if end %}&end={{ end|to_jalali }}{% endif %}" aria-label="Next">
                                        <i data-feather="chevron-right" class="width-15 height-15"></i>
                                    </a>
                                    {% else %}
                                    <a class="page-link" href="#" aria-label="Next">
                                        <i data-feather="chevron-right" class="width-15 height-15"></i>
                                    </a>

                                    {% endif %}
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
            <div class="card card-body app-content-body">
                <div class="app-lists">
                    <ul class="list-group list-group-flush" id="main_ul">
                       {% include 'mrp/purchase/partialPurchaseList_v2.html' %}
                        
                      
                    </ul>
                </div>
                <!-- end::app-lists -->

                <!-- begin:app-detail -->
                <div class="card app-detail ajax-content" style="overflow: scroll;">
                    
                </div>
            </div>
        </div>
    </div>

</div>

<div class="modal fade" tabindex="-1" role="dialog" id="rejectRequestModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            
        </div>
    </div>
</div>

{% endblock %}
{% block javascript %}
  <!-- Plugin scripts -->
  <script src="{% static 'vendors/select2/js/select2.min.js' %}"></script>
  <script src="{% static 'assets/js/examples/select2.js' %}"></script>
  <script>
    $('.select2-example').select2({
        placeholder: 'اشخاص',
        
    });
    $('input[name="start"]').pDatepicker({
        format: 'YYYY-MM-DD',
                autoClose: true,
                initialValueType: 'gregorian',
                calendar:{
            persian: {
                leapYearMode: 'astronomical'
            }
        },
      });
    $('input[name="end"]').pDatepicker({
        format: 'YYYY-MM-DD',
                autoClose: true,
                initialValueType: 'gregorian',
                calendar:{
            persian: {
                leapYearMode: 'astronomical'
            }
        },
      });
  </script>
  
<script src="{% static 'project/purchase.js' %}"></script>

<script src="{% static 'project/purchaselist.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/tributejs@5.1.3/dist/tribute.min.js"></script>
<script>
    //var users1000 = {{ json_dict_list|safe }};
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    
    <script>
        // داده‌های نمونه - می‌توانید این داده‌ها را از سرور دریافت کنید
        const partsData = [
            {
                id: 'P001',
                name: 'فیلتر روغن',
                stock: 45,
                currentPrice: 250000,
                status: 'available',
                history: [
                    { date: '1402/10/15', quantity: 20, price: 220000, supplier: 'تامین کننده الف' },
                    { date: '1402/09/05', quantity: 30, price: 210000, supplier: 'تامین کننده ب' },
                    { date: '1402/07/20', quantity: 25, price: 200000, supplier: 'تامین کننده الف' },
                    { date: '1402/06/10', quantity: 15, price: 195000, supplier: 'تامین کننده پ' },
                    { date: '1402/04/25', quantity: 20, price: 180000, supplier: 'تامین کننده الف' }
                ]
            },
            {
                id: 'P002',
                name: 'لنت ترمز',
                stock: 12,
                currentPrice: 580000,
                status: 'low',
                history: [
                    { date: '1402/11/01', quantity: 15, price: 560000, supplier: 'تامین کننده ت' },
                    { date: '1402/09/20', quantity: 20, price: 540000, supplier: 'تامین کننده ب' },
                    { date: '1402/08/05', quantity: 10, price: 520000, supplier: 'تامین کننده ت' },
                    { date: '1402/06/15', quantity: 25, price: 500000, supplier: 'تامین کننده الف' }
                ]
            },
            {
                id: 'P003',
                name: 'باتری',
                stock: 0,
                currentPrice: 1200000,
                status: 'out',
                history: [
                    { date: '1402/10/10', quantity: 8, price: 1150000, supplier: 'تامین کننده ث' },
                    { date: '1402/08/22', quantity: 10, price: 1100000, supplier: 'تامین کننده ج' },
                    { date: '1402/07/05', quantity: 12, price: 1050000, supplier: 'تامین کننده ث' }
                ]
            },
            {
                id: 'P004',
                name: 'شمع موتور',
                stock: 68,
                currentPrice: 150000,
                status: 'available',
                history: [
                    { date: '1402/11/05', quantity: 40, price: 145000, supplier: 'تامین کننده چ' },
                    { date: '1402/10/01', quantity: 30, price: 140000, supplier: 'تامین کننده الف' },
                    { date: '1402/08/15', quantity: 35, price: 135000, supplier: 'تامین کننده چ' },
                    { date: '1402/07/01', quantity: 25, price: 130000, supplier: 'تامین کننده ب' },
                    { date: '1402/05/20', quantity: 30, price: 125000, supplier: 'تامین کننده چ' }
                ]
            },
            {
                id: 'P005',
                name: 'روغن موتور',
                stock: 25,
                currentPrice: 320000,
                status: 'available',
                history: [
                    { date: '1402/10/28', quantity: 50, price: 310000, supplier: 'تامین کننده ح' },
                    { date: '1402/09/12', quantity: 40, price: 300000, supplier: 'تامین کننده خ' },
                    { date: '1402/07/25', quantity: 45, price: 290000, supplier: 'تامین کننده ح' },
                    { date: '1402/06/05', quantity: 35, price: 280000, supplier: 'تامین کننده الف' }
                ]
            }
        ];

        let currentChart = null;

        // تابع برای فرمت کردن اعداد با کاما
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // تابع برای نمایش جدول
        function renderTable() {
            const tbody = $('#partsTableBody');
            tbody.empty();
            
            partsData.forEach(part => {
                let statusClass = '';
                let statusText = '';
                
                if (part.status === 'available') {
                    statusClass = 'status-available';
                    statusText = 'موجود';
                } else if (part.status === 'low') {
                    statusClass = 'status-low';
                    statusText = 'کم موجود';
                } else {
                    statusClass = 'status-out';
                    statusText = 'ناموجود';
                }
                
                const row = `
                    <tr>
                        <td><strong>${part.id}</strong></td>
                        <td>${part.name}</td>
                        <td>${part.stock}</td>
                        <td>${formatNumber(part.currentPrice)}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn btn-history btn-sm" onclick="showHistory('${part.id}')">
                                <i class="fas fa-history"></i> مشاهده سابقه
                            </button>
                        </td>
                    </tr>
                `;
                tbody.append(row);
            });
        }

        // تابع برای نمایش سابقه
        function showHistory(partId) {
            const part = partsData.find(p => p.id === partId);
            if (!part) return;
            
            // نمایش اطلاعات قطعه
            $('#partInfo').html(`
                <div class="alert alert-info">
                    <h5><strong>${part.name}</strong> (کد: ${part.id})</h5>
                    <p class="mb-0">قیمت فعلی: <span class="price-badge">${formatNumber(part.currentPrice)} تومان</span></p>
                </div>
            `);
            
            // نمایش لیست سابقه
            let historyHtml = '';
            part.history.forEach((item, index) => {
                historyHtml += `
                    <div class="history-item">
                        <div class="row">
                            <div class="col-md-3">
                                <i class="fas fa-calendar-alt"></i> ${item.date}
                            </div>
                            <div class="col-md-3">
                                <i class="fas fa-box"></i> تعداد: ${item.quantity}
                            </div>
                            <div class="col-md-3">
                                <i class="fas fa-money-bill-wave"></i> ${formatNumber(item.price)} تومان
                            </div>
                            <div class="col-md-3">
                                <i class="fas fa-truck"></i> ${item.supplier}
                            </div>
                        </div>
                    </div>
                `;
            });
            $('#historyList').html(historyHtml);
            
            // رسم نمودار
            drawChart(part);
            
            // نمایش مودال
            // const modal = new bootstrap.Modal(document.getElementById('historyModal'));
            $('#historyModal').modal({
                backdrop: false
            });
            // modal.show();
        }

        // تابع برای رسم نمودار
        function drawChart(part) {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            // حذف نمودار قبلی
            if (currentChart) {
                currentChart.destroy();
            }
            
            // آماده‌سازی داده‌های نمودار
            const labels = part.history.map(h => h.date).reverse();
            const prices = part.history.map(h => h.price).reverse();
            
            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'قیمت (تومان)',
                        data: prices,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointBackgroundColor: '#667eea',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'قیمت: ' + formatNumber(context.parsed.y) + ' تومان';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return formatNumber(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        // بارگذاری اولیه
        $(document).ready(function() {
            renderTable();
        });
    </script>


{% endblock %}
