{% load static %}
<div class=" card-body border p-3">
    <ul class="nav nav-tabs mb-3" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab"
             aria-controls="home" aria-selected="true">پیوست</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab"
             aria-controls="profile" aria-selected="false">کامنت</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab"
             aria-controls="contact" aria-selected="false">فعالیت</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="contact-tab" data-toggle="tab" href="#notes" role="tab"
               aria-controls="contact" aria-selected="false">یادداشت های من</a>
          </li>
      </ul>
      <div class="tab-content">
        <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
            {% if files %}
            <div class="card-body">
                <h6 class="mb-3 font-size-11 text-uppercase">فایلهای پیوست شده</h6>
                <ul class="list-unstyled mb-0">
                    {% for i in files %}
                    <li class="small">
                        <a target="_blank" href="{{i.file.url}}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-paperclip mr-1 width-15 height-15"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
                           {{i}}
                        </a>
                    </li>
                    {% endfor %}
                    
                </ul>
            </div>
            {% endif %}
            <div class="card-body">
                <form id="image-upload-form" method="post" enctype="multipart/form-data">
                    <div id="image-container" class="mb-3">
                      <!-- Dynamic image input fields will be added here -->
                    </div>
                    <div class="d-flex justify-content-center align-items-center">
                      <button type="button" id="add-image-btn" class="btn btn-secondary">
                        <i class="fas fa-plus mr-2"></i>افزودن تصویر
                      </button>
                     
                      
                    
                    </div>
                  </form>
            </div>
            
        </div>
        <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
            <div id="comments-section">
                {% for comment in comments %}
                   
                    <div class="card card-body border p-3">
                        <div class="d-flex mb-3">
                            <div class="d-flex align-items-center">
                                <figure class="avatar avatar-sm mr-3">
                                    <img src="{{ comment.user.profileImage.url }}" class="rounded-circle" alt="...">
                                </figure>
                                <div class="d-inline-block">
                                    <div><strong>{{comment.user.fullName}}</strong></div>
                                    <small class="text-muted">{{ comment.created_at|timesince }} قبل</small>
                                </div>
                            </div>
                            <div class="dropdown ml-auto">
                                <a href="#" data-toggle="dropdown">
                                    <i class="fa fa-ellipsis-v"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a href="#" class="dropdown-item">اشتراک</a>
                                    <a href="#" class="dropdown-item">ویرایش</a>
                                    <a href="#" class="dropdown-item">حذف</a>
                                </div>
                            </div>
                        </div>
                        <p>{{comment.content}}</p>
                       
                    </div>
                    {% endfor %}
                
               
            </div>
            <div class="card-body" >
                <h6 class="mb-3 font-size-11 text-uppercase">کامنت</h6>
                <div class="d-flex">
                    <div>
                        <figure class="avatar avatar-sm mr-3">
                            <img src="{{ request.user.sysuser.profileImage.url}}" class="rounded-circle" alt="...">
                        </figure>
                    </div>
                    <div class="flex-grow-1">
                        <div class="form-group">
                            <textarea rows="2" class="form-control" id="comment-text"></textarea>
                        </div>
                        <button class="btn btn-outline-light" id="add-comment-btn">
                                            <i data-feather="send"></i>
                        </button>
                    </div>
                </div>
               
            </div>
        
        
        </div>
        <div class="tab-pane fade" id="notes" role="tabpanel" aria-labelledby="profile-tab" style="max-height: 800px; overflow-y: auto;">
            <div id="notes-section">
                {% for comment in notes %}
                   
                    <div class="card card-body border p-3">
                        <div class="d-flex mb-3">
                            <div class="d-flex align-items-center">
                                <figure class="avatar avatar-sm mr-3">
                                    <img src="{{ comment.user.profileImage.url }}" class="rounded-circle" alt="...">
                                </figure>
                                <div class="d-inline-block">
                                    <div><strong>{{comment.user.fullName}}</strong></div>
                                    <small class="text-muted">{{ comment.created_at|timesince }} قبل</small>
                                </div>
                            </div>
                            <div class="dropdown ml-auto">
                                <a href="#" data-toggle="dropdown">
                                    <i class="fa fa-ellipsis-v"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a href="#" class="dropdown-item">اشتراک</a>
                                    <a href="#" class="dropdown-item">ویرایش</a>
                                    <a href="#" class="dropdown-item">حذف</a>
                                </div>
                            </div>
                        </div>
                        <p>{{comment.content}}</p>
                       
                    </div>
                    {% endfor %}
                
               
            </div>
            <div class="card-body" >
                <h6 class="mb-3 font-size-11 text-uppercase">پاسخ</h6>
                <div class="d-flex">
                    <div>
                        <figure class="avatar avatar-sm mr-3">
                            <img src="{{ request.user.sysuser.profileImage.url}}" class="rounded-circle" alt="...">
                        </figure>
                    </div>
                    <div class="flex-grow-1">
                        <div class="form-group">
                            <textarea rows="2" class="form-control" id="note-text"></textarea>
                        </div>
                        <button class="btn btn-outline-light" id="add-note-btn">
                                            <i data-feather="send"></i>
                        </button>
                    </div>
                </div>
            </div>
        
        
        </div>
        <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab" style="max-height: 800px; overflow-y: auto;">
            {% for i in logs %}
            <div class="d-flex align-items-center p-l-r-0 m-b-20">
                <div class="d-flex align-items-center">
                    <figure class="avatar avatar-sm m-r-15">
                        <img src="{{i.user.profileImage.url}}" class="rounded-circle" alt="image">
                    </figure>
                    <div>
                        <h6 class="m-b-0">
                            <span class="text-primary"> {{i.action|safe}}</span>
                        </h6>
                        
                    </div>
                </div>
                <div class="ml-auto">
                   
                    <span class="text-muted">{{i.get_dateCreated_jalali}}<br/> {{i.timestamp|time:'H:i'}}</span>
                </div>
            </div>
            {% endfor %}
        </div>
      </div>
</div>
<script>
    // Dummy users list
    $(document).ready(function () {
        $("#profile").niceScroll({
            cursorcolor: "#00f", // Customize scrollbar color
            cursorwidth: "8px", // Width of the scrollbar
            background: "#ddd", // Background of the scrollbar track
            autohidemode: true  // Hide scrollbar when not scrolling
        });
        $("#notes").niceScroll({
            cursorcolor: "#00f", // Customize scrollbar color
            cursorwidth: "8px", // Width of the scrollbar
            background: "#ddd", // Background of the scrollbar track
            autohidemode: true  // Hide scrollbar when not scrolling
        });
        // Dummy users list
        let users1000 = [
            // { key: "arzande", value: "arzande" },
            // { key: "ezami", value: "ezami" },

            // { key: "torabi", value: "torabi" },
            // { key: "abedi", value: "abedi" },
            
        ];
        $.ajax({
                url: '/api/users/', // Django endpoint
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    let users = data.users;
                    // let output = '<ul>';
                    $.each(users, function(index, user) {
                        // output += `<li>ID: ${user.key} - Full Name: ${user.value}</li>`;
                        users1000.push({ key: user.value, value: user.key });
                    });
                    // output += '</ul>';
                    // $('#user-list').html(output);

                    // =data.users
                    console.log(users1000);
                    
                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);
                    $('#user-list').html('<p>Error loading data</p>');
                }
            });

        // Initialize Tribute.js
        let tribute = new Tribute({
            trigger: "@",
            values: users1000,
            selectTemplate: function (item) {
                return "@" + item.original.value; // Inserts @username into text
            }
        });

        // Attach Tribute.js to the textarea using jQuery
        let commentBox = $("#comment-text");
        if (commentBox.length) {
            tribute.attach(commentBox[0]); // Access the raw DOM element from jQuery object
        } else {
            console.error("Comment box not found!");
        }
    });
</script>
</script>