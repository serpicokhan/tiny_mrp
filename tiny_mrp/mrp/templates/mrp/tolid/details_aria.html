{% extends 'mrp/blank-page.html' %}
{% load static %}
{% block stylesheet %}
<link rel="stylesheet" href="{% static 'vendors/select2/css/select2.min.css' %}" type="text/css">
<!-- Add this CSS for better RTL support and styling -->
<style>
.select2-container {
    width: 100% !important;
}

.select2-container--default .select2-selection--single {
    height: 38px;
    line-height: 36px;
    border: 1px solid #ced4da;
    border-radius: 0.25rem;
}

.select2-container--default .select2-selection--single .select2-selection__rendered {
    padding-right: 12px;
    padding-left: 20px;
}

.select2-container--default .select2-selection--single .select2-selection__arrow {
    right: auto;
    left: 1px;
}

/* RTL support */
.select2-container[dir="rtl"] .select2-selection--single .select2-selection__rendered {
    text-align: right;
}

.select2-container[dir="rtl"] .select2-selection--single .select2-selection__arrow {
    left: auto;
    right: 1px;
}

/* Multiple selection styling */
.select2-container--default .select2-selection--multiple {
    min-height: 38px;
    border: 1px solid #ced4da;
    border-radius: 0.25rem;
}

.select2-container--default .select2-selection--multiple .select2-selection__choice {
    background-color: #007bff;
    border: 1px solid #006fe6;
    border-radius: 4px;
    color: #fff;
    margin-right: 5px;
    margin-top: 5px;
    padding: 0 8px;
}

.select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
    color: rgba(255,255,255,.7);
    float: left;
    margin-left: 5px;
    margin-right: -2px;
}

.select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover {
    color: #fff;
}

/* RTL support for multiple selection */
.select2-container[dir="rtl"] .select2-selection--multiple .select2-selection__choice {
    margin-left: 5px;
    margin-right: 0;
}

.select2-container[dir="rtl"] .select2-selection--multiple .select2-selection__choice__remove {
    float: right;
    margin-left: -2px;
    margin-right: 5px;
}
/* اضافه کردن این CSS به بخش style موجود */

/* تنظیم عرض ستون‌های جدول */
.company-table {
    table-layout: fixed;
    width: 100%;
}

.company-table th,
.company-table td {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    padding: 8px 5px;
}

/* تنظیم عرض ستون‌های مختلف */
.company-table th:nth-child(1),  /* نام ماشین */
.company-table td:nth-child(1) {
    width: 12%;
    min-width: 100px;
}

.company-table th:nth-child(2),  /* اپراتور */
.company-table td:nth-child(2) {
    width: 15%;
    min-width: 120px;
}

.company-table th:nth-child(3),  /* کد نخ */
.company-table td:nth-child(3) {
    width: 12%;
    min-width: 100px;
}

.company-table th:nth-child(4),  /* واحد */
.company-table td:nth-child(4) {
    width: 8%;
    min-width: 70px;
}

.company-table th:nth-child(5),  /* نمره */
.company-table td:nth-child(5) {
    width: 8%;
    min-width: 70px;
}

.company-table th:nth-child(6),  /* سرعت */
.company-table td:nth-child(6) {
    width: 8%;
    min-width: 70px;
}

.company-table th:nth-child(7),  /* کنتور ابتدای شیفت */
.company-table td:nth-child(7) {
    width: 10%;
    min-width: 90px;
}

.company-table th:nth-child(8),  /* کنتور انتهای شیفت */
.company-table td:nth-child(8) {
    width: 10%;
    min-width: 90px;
}

.company-table th:nth-child(9),  /* 100% */
.company-table td:nth-child(9) {
    width: 8%;
    min-width: 70px;
}

.company-table th:nth-child(10), /* تولید */
.company-table td:nth-child(10) {
    width: 9%;
    min-width: 80px;
}

/* تنظیم Select2 برای اپراتور و کد نخ */
.company-table .select2-container {
    width: 100% !important;
    min-width: 0;
}

.company-table .select2-selection--single,
.company-table .select2-selection--multiple {
    height: auto !important;
    min-height: 30px !important;
    border: 1px solid #dee2e6 !important;
    border-radius: 3px !important;
    font-size: 13px;
}

.company-table .select2-selection__rendered {
    padding: 2px 5px !important;
    line-height: 1.3 !important;
}

.company-table .select2-selection__choice {
    font-size: 11px !important;
    padding: 2px 6px !important;
    margin: 1px 2px !important;
}

/* برای نمایش کامل متن هنگام hover */
.company-table td:hover {
    overflow: visible;
    white-space: normal;
    word-wrap: break-word;
    position: relative;
    z-index: 1;
    background-color: #f8f9fa;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

/* تنظیم responsive */
@media (max-width: 1200px) {
    .company-table th:nth-child(1),
    .company-table td:nth-child(1) {
        width: 10%;
        min-width: 80px;
    }
    
    .company-table th:nth-child(2),
    .company-table td:nth-child(2) {
        width: 13%;
        min-width: 100px;
    }
    
    .company-table th:nth-child(3),
    .company-table td:nth-child(3) {
        width: 10%;
        min-width: 80px;
    }
}

@media (max-width: 768px) {
    .company-table {
        font-size: 12px;
    }
    
    .company-table th,
    .company-table td {
        padding: 4px 2px;
    }
    
    .company-table .select2-selection__rendered {
        font-size: 11px !important;
    }
}
  </style>
{% endblock %}
{% block content %}
<div class="row app-block">

                <div class="col-md-12 app-content">
                    <div></div>
                    <div class="app-action">
                        <div class="action-left">
                            
                            <ul class="list-inline">
                              <li class="list-inline-item mb-0">
                                <button type="button" name="button" class="btn btn-outline-light" id="save_production">ذخیره</button>
                              </li>
                              <li class="list-inline-item mb-0">
                                <button type="button" name="button" class="btn btn-outline-light" id="new_amar">جدید</button>
                              </li>
                                <li class="list-inline-item mb-0">
                                    <a href="#" class="btn btn-outline-light dropdown-toggle" data-toggle="dropdown">
                                      عملیات
                                    </a>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item add-zayeat" href="#" data-url="{%url 'zayeatVazn_create' %}">ورود ضایعات</a>
                                        <a class="dropdown-item delete-info" href="#" data-url="{%url 'delete_amar_info' %}">حذف</a>


                                    </div>
                                </li>

                                <li class="list-inline-item mb-0" style="width:90pt">
                                  <select class="form-control" aria-label="Default select example" id="select_shift">
                                    {% for i in shifts %}
                                    
                                    <option x="{{shift_id}}" value="{{i.id}}" {% if i.id == shift_id %} selected {% endif %}>{{i.name}}</option>
                                    {% endfor %}
                               
                                  </select>
                                </li>
                                <li class="list-inline-item mb-0" style="width:90pt">
                                  <select class="form-control" aria-label="Default select example" id="select_makan">
                                    {% for i in makan %}
                                    
                                    <option  value="{{i.id}}" {% if i.id == makan_id %} selected {% endif %}>{{i.assetName}}</option>
                                    {% endfor %}
                               
                                  </select>
                                </li>
                                
                            </ul>
                        </div>
                        <div class="action-right">
                            <form class="d-flex mr-3">
                               
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="جستجو ایمیل" aria-describedby="button-addon1" id="search" >
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-light" type="button" id="button-addon1" data-url="{% url 'list_amar_daily_info' %}">
                                            <i class="ti-search"></i>
                                        </button>
                                    </div>
                                </div>

                            </form>
                          

                        </div>
                        
                        <div class="app-pager d-flex align-items-center">
                                <div class="mr-3"></div>
                                <nav aria-label="Page navigation example">
                                    <ul class="pagination">
                                        <li class="page-item">
                                            <a class="page-link" href="#" data-url="/Tolid/Asset/LoadInfo?event={{prev_date}}&shift_id={{shift_id}}" id='btn_prev_date' aria-label="Previous">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left width-15 height-15"><polyline points="15 18 9 12 15 6"></polyline></svg>
                                            </a>
                                        </li>
                                        <li class="page-item">
                                            <a class="page-link" href="#" data-url="/Tolid/Asset/LoadInfo?event={{next_date}}&shift_id={{shift_id}}" id='btn_next_date'  aria-label="Next">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right width-15 height-15"><polyline points="9 18 15 12 9 6"></polyline></svg>
                                            </a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                    </div>
                    <div class="card card-body app-content-body">

                        <div class="card-body">
                          <h5 class="card-title">آمار روزانه</h5>
                          <ul class="nav nav-pills mb-3" role="tablist">

                            {% for c in cat_list %}
        
                            <li class="nav-item">
                                <a class="nav-link {% if forloop.counter == 1 %}active
                                {% endif %}" id="tab{{c.id}}" data-toggle="tab" href="#sub{{c.id}}"
                                role="tab" aria-controls="sub{{c.id}}" aria-selected="{% if forloop.counter == 1 %}true
                                {% else %}false{% endif %}">{{c.name}}</a>
                            </li>
                            {% endfor %}
        
                        </ul>

                        <div class="tab-content">
                          {% for cat_item in cat_list %}
      
                          <div class="tab-pane fade {% if forloop.counter == 1 %}active show {% endif %}"
                          id="sub{{cat_item.id}}" role="tabpanel" aria-labelledby="sub{{cat_item.id}}">
                          <div class="row tblrows">
                            
                            

                           
                            <div class="col-md-12">

                              
                              <div class="table-responsive">
                                <table class="table table-bordered table-striped company-table">
                                  <thead class="thead-dark">
                                      <tr>
                                          <th>نام ماشین</th>
                                          <th>اپراتور</th> <!-- ستون جدید برای نام اپراتور -->
                                          <th>کد نخ</th>
                                          <th>واحد</th>
                                          <th>نمره</th>
                                          <th>سرعت</th>
                                          <th>کنتور ابتدای شیفت</th>
                                          <th>کنتور انتهای شیفت</th>
                                          <th>100%</th>
                                          <th>تولید</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      {% for c in machines %}
                                      {% if c.machine.assetCategory.id == cat_item.id %}
                                      <tr data-machine={{c.machine.id}} data-shift="{{i.id}}" data-speed2="{{c.speed}}">
                                          <td>{{c.machine.assetName}}</td>
                                          
                                          <!-- سلول جدید برای نام اپراتور -->
                                          <td>
                                            <select class="form-control operator-name" 
                                            data-machine-id="{{c.machine.id}}"
                                            multiple="multiple"
                                            style="width: 100%;">
                                            </select>
                                            <!-- Single hidden field to store all operator data as JSON -->
                                            <input type="hidden" class="operator-data" name="operator_data" ">
                                        </td>
                                        <td>
                                          <select class="form-control nakh-name" 
                                          data-machine-id="{{c.machine.id}}"
                                          
                                          style="width: 100%;">
                                          </select>
                                          <!-- Single hidden field to store all operator data as JSON -->
                                          <input type="hidden" class="nakh-data" name="nakh_data_{{c.machine.id}}">
                                      </td>
                                          
                                          <td contenteditable="true" class="editable-cell btc vahed selectable1" data-vahed="{{c.machine.assetVahed}}">{{c.vahed}}</td>
                                          <td contenteditable="true" class="editable-cell btc nomre selectable1">{{c.nomre}}</td>
                                          <td contenteditable="true" class="editable-cell2 btc speed selectable1" data-nomre={{c.nomre}}>{{c.speed}}</td>
                                          <td contenteditable="true" class="editable-cell btc counter1 selectable1"></td>
                                          <td contenteditable="true" class="editable-cell btc counter2 selectable1"></td>
                                          <td contenteditable="true" class="editable-cell3 production_full selectable1" data-maxformula="{{c.speedformula}}" data-vahed="{{c.machine.assetVahed}}">{{c.max}}</td>
                                          <td contenteditable="true" data-formula="{{c.formula}}" class='production'></td>
                                      </tr>
                                      {% endif %}
                                      {% endfor %}
                                  </tbody>
                              </table>
                              </div>
                            </div>
                       
                           



                          </div>


      
      
                              
      
      
      
      
                          </div>
                          {% endfor %}
                         

                        </div>
                        <div class="modal fade" id="modal-company">
                         <div class="modal-dialog  modal-lg ">

                           <div class="modal-content ">
                           </div>
                         </div>
                        </div>
                      </div>
                        <!-- end::app-lists -->

                        <!-- begin:app-detail -->


            </div>


          </div>


{% endblock %}
{% load static %}

{% block javascript %}
<script src="{% static 'vendors/select2/js/select2.min.js' %}"></script>

 <script src="{% static 'project/tolid.js' %}"></script>
 <script>
  $(document).ready(function() {
    var myVar = "{{ selected_date|escapejs }}";
    if(myVar!="False"){
    $("#search").val(myVar);
    }
    // console.log(myVar);
  });
</script>
{% endblock %}
